(function(){"use strict";var e={3711:function(e,t,n){var a=n(9242),o=n(3396);function s(e,t,n,a,s,l){const i=(0,o.up)("TelegramSettings");return(0,o.wg)(),(0,o.j4)(i)}var l=n(9645),i=n(7139);const r=e=>((0,o.dD)("data-v-b57fd772"),e=e(),(0,o.Cn)(),e),d=r((()=>(0,o._)("br",null,null,-1))),u=r((()=>(0,o._)("br",null,null,-1))),c=r((()=>(0,o._)("br",null,null,-1))),h={class:"switch-group"};function m(e,t,n,s,l,r){const m=(0,o.up)("MDBCardTitle"),f=(0,o.up)("MDBInput"),p=(0,o.up)("MDBCardText"),g=(0,o.up)("MDBBtn"),v=(0,o.up)("MDBCardBody"),w=(0,o.up)("MDBCard"),M=(0,o.up)("SettingsItem"),B=(0,o.up)("MDBAccordionItem"),y=(0,o.up)("MDBAccordion"),b=(0,o.up)("MDBModalTitle"),D=(0,o.up)("MDBModalHeader"),k=(0,o.up)("MDBModalBody"),C=(0,o.up)("MDBModalFooter"),_=(0,o.up)("MDBModal"),S=(0,o.up)("MDBContainer");return(0,o.wg)(),(0,o.j4)(S,null,{default:(0,o.w5)((()=>[(0,o.Wm)(w,null,{default:(0,o.w5)((()=>[(0,o.Wm)(v,null,{default:(0,o.w5)((()=>[(0,o.Wm)(m,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Connectivity settings")])),_:1}),(0,o.Wm)(p,null,{default:(0,o.w5)((()=>[(0,o.Wm)(f,{modelValue:l.token,"onUpdate:modelValue":t[0]||(t[0]=e=>l.token=e),label:"Bot token",onChange:t[1]||(t[1]=e=>r.setUnsaved())},null,8,["modelValue"]),d,(0,o.Wm)(f,{modelValue:l.chatId,"onUpdate:modelValue":t[2]||(t[2]=e=>l.chatId=e),label:"Chat ID",onChange:t[3]||(t[3]=e=>r.setUnsaved())},null,8,["modelValue"])])),_:1}),(0,o.Wm)(g,{disabled:l.saving,color:"primary",onClick:(0,a.iM)(r.saveSettings,["prevent"])},{default:(0,o.w5)((()=>[(0,o.Uk)("Save")])),_:1},8,["disabled","onClick"]),(0,o.Wm)(g,{disabled:!1===l.saved&&!1===l.saving,color:"primary",onClick:(0,a.iM)(r.testSettings,["prevent"])},{default:(0,o.w5)((()=>[(0,o.Uk)("Test ")])),_:1},8,["disabled","onClick"])])),_:1})])),_:1}),u,c,(0,o.Wm)(w,null,{default:(0,o.w5)((()=>[(0,o.Wm)(v,null,{default:(0,o.w5)((()=>[(0,o.Wm)(m,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Notification settings")])),_:1}),(0,o.Wm)(p,null,{default:(0,o.w5)((()=>[(0,o.Wm)(y,{modelValue:s.activeItem,"onUpdate:modelValue":t[4]||(t[4]=e=>s.activeItem=e)},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(l.notifications,((e,t)=>((0,o.wg)(),(0,o.j4)(B,{key:t,collapseId:t,headerTitle:r.getTitle(e)},{default:(0,o.w5)((()=>[(0,o._)("ul",h,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.statuses,((e,n)=>((0,o.wg)(),(0,o.iD)("li",{key:n,class:"switch-group-item"},[(0,o.Wm)(M,{value:e,name:n,loading:r.getSpinner(t,n),onStatusChange:e=>this.handleChange(t,n,e)},null,8,["value","name","loading","onStatusChange"])])))),128))])])),_:2},1032,["collapseId","headerTitle"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),(0,o.Wm)(_,{id:"modal",modelValue:s.modal,"onUpdate:modelValue":t[6]||(t[6]=e=>s.modal=e),labelledby:"modalLabel",tabindex:"-1"},{default:(0,o.w5)((()=>[(0,o.Wm)(D,null,{default:(0,o.w5)((()=>[(0,o.Wm)(b,{id:"modalLabel"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,i.zw)(l.modalTitle),1)])),_:1})])),_:1}),(0,o.Wm)(k,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,i.zw)(l.modalBody),1)])),_:1}),(0,o.Wm)(C,null,{default:(0,o.w5)((()=>[(0,o.Wm)(g,{color:"secondary",onClick:t[5]||(t[5]=e=>s.modal=!1)},{default:(0,o.w5)((()=>[(0,o.Uk)("Ok")])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})}var f=n(4313),p=n(4870);const g={class:"checkbox-wrapper"},v={key:0,class:"request-saved","data-test":"loader"};function w(e,t,n,a,s,l){const i=(0,o.up)("MDBSwitch");return(0,o.wg)(),(0,o.iD)("div",g,[(0,o.Wm)(i,{modelValue:e.status,"onUpdate:modelValue":t[0]||(t[0]=t=>e.status=t),label:e.name,disabled:e.loading},null,8,["modelValue","label","disabled"]),e.loading?((0,o.wg)(),(0,o.iD)("span",v,"Saving...")):(0,o.kq)("",!0)])}var M=(0,o.aZ)({name:"SettingsItem",components:{MDBSwitch:f.xc},data(){return{status:this.value}},props:["name","value","loading"],watch:{status:{handler(){this.$emit("statusChange",this.status)}}}}),B=n(89);const y=(0,B.Z)(M,[["render",w],["__scopeId","data-v-80e71972"]]);var b=y,D={name:"TelegramSettings",components:{MDBCard:f.Yl,MDBCardBody:f.H7,MDBCardTitle:f.QM,MDBCardText:f.Pp,MDBBtn:f.$v,MDBContainer:f.L5,MDBInput:f.u2,MDBAccordion:f.FI,MDBAccordionItem:f.nn,MDBModal:f.j3,MDBModalHeader:f.ol,MDBModalTitle:f.wo,MDBModalBody:f.Yz,MDBModalFooter:f.ab,SettingsItem:b},data(){return{token:"",chatId:"",notifications:{},saved:!0,saving:!1,spinners:{},modalTitle:"",modalBody:""}},setup(){const e=(0,p.iH)("collapseOne"),t=(0,p.iH)(!1);return{activeItem:e,modal:t}},async created(){try{const e=await fetch("/api/settings"),{token:t,chatId:n,notifications:a}=await e.json();this.token=t,this.chatId=n,this.notifications=a}catch(e){this.showError("Request failed: "+e)}},methods:{showError(e="Some error"){this.modalTitle="Error!",this.modalBody=e,this.modal=!0},showAlert(e=""){this.modalTitle="OK!",this.modalBody=e,this.modal=!0},getSpinner(e,t){return!(!this.spinners[e]||!this.spinners[e][t])},setSpinner(e,t,n){this.spinners[e]||(this.spinners[e]={}),this.spinners[e][t]=n},setUnsaved(){this.saved=!1},async saveSettings(){this.saving=!0,await this.makeRequest(!1),this.saving=!1},async testSettings(){const e={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:"This is a test message"})};try{await fetch("/api/test-message",e).then((e=>{switch(e.status){case 204:case 200:return void this.showAlert("request successfully sent!");case 400:case 401:case 500:default:e.json().then((e=>{this.showError("Request failed: "+e.detail)}))}}))}catch(t){this.showError("Request failed: "+t)}},async handleChange(e,t,n){console.log(e),console.log(t),console.log(n),this.notifications[e].statuses[t]=n,this.setSpinner(e,t,!0),await this.makeRequest(!0),this.setSpinner(e,t,!1)},async makeRequest(e){let t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:this.token,chatId:this.chatId,notifications:this.notifications})};try{await fetch("/api/settings",t),e||this.showAlert("Settings saved!"),this.saved=!0}catch(n){this.showError("Request failed: "+n)}},getTitle(e){const t=Object.keys(e.statuses).map((t=>e.statuses[t])).filter(Boolean).length,n=Object.keys(e.statuses).length;return`${e.title} (${t} of ${n} enabled)`}}};const k=(0,B.Z)(D,[["render",m],["__scopeId","data-v-b57fd772"]]);var C=k,_={name:"App",components:{TelegramSettings:C},created(){(0,l.ZP)({})}};const S=(0,B.Z)(_,[["render",s]]);var T=S;(0,a.ri)(T).mount("#app")}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var s=t[a]={exports:{}};return e[a](s,s.exports,n),s.exports}n.m=e,function(){var e=[];n.O=function(t,a,o,s){if(!a){var l=1/0;for(u=0;u<e.length;u++){a=e[u][0],o=e[u][1],s=e[u][2];for(var i=!0,r=0;r<a.length;r++)(!1&s||l>=s)&&Object.keys(n.O).every((function(e){return n.O[e](a[r])}))?a.splice(r--,1):(i=!1,s<l&&(l=s));if(i){e.splice(u--,1);var d=o();void 0!==d&&(t=d)}}return t}s=s||0;for(var u=e.length;u>0&&e[u-1][2]>s;u--)e[u]=e[u-1];e[u]=[a,o,s]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={314:0};n.O.j=function(t){return 0===e[t]};var t=function(t,a){var o,s,l=a[0],i=a[1],r=a[2],d=0;if(l.some((function(t){return 0!==e[t]}))){for(o in i)n.o(i,o)&&(n.m[o]=i[o]);if(r)var u=r(n)}for(t&&t(a);d<l.length;d++)s=l[d],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return n.O(u)},a=self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=n.O(void 0,[998],(function(){return n(3711)}));a=n.O(a)})();
//# sourceMappingURL=setting.113f74ed.js.map